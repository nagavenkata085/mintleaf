<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Mintleaf Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" alt="Logo" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://getmintleaf.org'>getmintleaf.org</a></li>
            <li><a href='https://github.com/senips/mintleaf'>Source @ github</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Welcome to the Mintleaf! Mintleaf is a light weight framework tool helps you to advance your database developement on continuous integration / continuous delivery model as easy as possible.</p>

<h3 id="features">Features</h3>

<ul>
<li>Database Migration (either from command line or programatic approach)</li>
<li>Ability to write automated tests and run them on migrated database schemas, objects, data integrity checks during CI/CD</li>
<li>Seamless Test life cycle management such as setup, teardown mock data, schema and any database objects using changesets</li>
<li>Transfer/Copy data between datbases</li>
<li>Nothing more but to use Plain old SQL that you know of</li>
</ul>

<p><strong><em>Before we deep dive into the Mintleaf, lets look at what migration means and how it works.</em></strong></p>

<h2 id="migration-at-a-glance">Migration at a glance</h2>

<p>Database migraton refers to the management of incremental, reversible changes to relational database schemas. A schema migration is performed on a database whenever it is necessary to update or revert that database&rsquo;s schema to some newer or older version.  Look at the below diagram which shows you the schema changes over a period of time during a Agile Software Developement Life Cycle.   Every schema changes during a developement sprint will be applied to QA Databases and Prod Database at the end of sprint release.  </p>

<p><img src="images/basicflow.png" alt="Database Migration" />   </p>

<p>When developing software applications backed by a database, developers typically develop the application source code in tandem with an evolving database schema. The code typically has rigid expectations of what columns, tables and constraints are present in the database schema whenever it needs to interact with one, so only the version of database schema against which the code was developed is considered fully compatible with that version of source code.</p>

<h4 id="version-control-systems-v-s-database-migration-versions">Version Control Systems v.s Database Migration Versions?</h4>

<p>Teams of software developers usually use version control systems to manage and collaborate on changes made to versions of source code. Different developers can develop on divergent, relatively older or newer branches of the same source code to make changes and additions during development.  So version control system by itself does not maintain database versions but data migration tools does it for you.  So using Mintleaf you can maintain your database versions either upgrade to a newer version or degrade it a older version. </p>

<h2 id="why-mintleaf">Why MintLeaf?</h2>

<p>Schema migration to a production database is always a risky task. Production databases are usually huge, old, and full of surprise things like the following </p>

<ul>
<li>Assumptions on certian data conditions </li>
<li>Implied dependencies which no body knows</li>
<li>Unclean / stale data which are hard to resolve </li>
<li>Direct schema patches for bug fixes </li>
<li>Direct performance fixes
and so on&hellip;.</li>
</ul>

<blockquote>
<p>So for these reasons, a solid migration process needs high level of discipline through build, test and deploy strategy is a way to go as like shown in below diagram where <strong>Mintleaf</strong> serves as a tool and as a framework to help an organisation move forward to next level of Agile Database Developement.</p>
</blockquote>

<p><img src="images/overall.png" alt="Mintleaf" />   </p>

<p>So again, welcome to the Mintleaf!  Mintleaf is a light weight framework tool helps you to advance your database developement on continuous integration / continuous delivery model as easy as possible.</p>

<h1 id="understanding-mintleaf">Understanding Mintleaf</h1>

<p>Let&rsquo;s look at the core concepts behind Mintleaf design so that you will be able to understand and use it accordingly before you move onto technical section.  Here is the simple steps to get you started quick.</p>

<h2 id="changesets">Changesets</h2>

<p>Changesets are basically contains one ore more changes that are to be applied during a database migration.  Mintleaf changesets are stored in plain old sql files but changeset information is described using sql comment lines as shown below </p>
<pre class="highlight sql tab-sql"><code> <span class="c1">-- &lt;ChangeSet id="{a-change-set-id}" delimiter=";" userdata="" /&gt;</span>
</code></pre>
<p>where,</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>The ID of the changeset and it should be unique</td>
</tr>
<tr>
<td>delimiter</td>
<td>Sql DDL/DML statement delimiter</td>
</tr>
<tr>
<td>userdata</td>
<td>user defined columns that one can store additional meta data of the changeset.</td>
</tr>
</tbody></table>

<p><strong><em>For example, a file &lsquo;abcdb-changeset.sql&rsquo; contains the following two changesets: create schema and create tables</em></strong></p>
<pre class="highlight sql tab-sql"><code><span class="c1">-- &lt;ChangeSet id="create schema" delimiter=";" userdata="" /&gt;</span>
<span class="k">DROP</span> <span class="k">SCHEMA</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">ABCDB</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">ABCDB</span><span class="p">;</span>

<span class="c1">-- &lt;ChangeSet id="create tables" delimiter=";" userdata="" /&gt; </span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">ABCDB</span><span class="p">.</span><span class="n">USERS</span>
<span class="p">(</span>
  <span class="n">USERID</span>      <span class="n">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">USERNAME</span>    <span class="n">VARCHAR2</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
  <span class="n">RATE</span>        <span class="n">NUMBER</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
  <span class="n">CREATE_TIME</span> <span class="n">DATE</span> <span class="k">DEFAULT</span> <span class="n">sysdate</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">PK_USERID</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">USERID</span><span class="p">)</span>
<span class="p">);</span>

</code></pre>
<!--Tips: -->

<!--- Create a folder-->

<!--- Under that new folder, just create plain old sql file with an extension .sql-->

<!--- Edit that sql file to create a new changeset by starting a single line comment inside that sql file-->

<!--- Add your changes (DDL/DML scripts) after changeset comment line declaration-->

<!--- And repeat as much as changeset that you like and you can create as many as sql files as you like to spread them up-->

<aside class="notice"> 
It&rsquo;s very easy to add changeset definition on your exising sql files if you would like.  So nothing much to do apart from this comment line declaration. 
</aside>

<h2 id="configuration-file">Configuration file</h2>

<p>Version profile is a configuration file which contains list of changesets to be applied for a particular version of a database migration.  Typically you will have all versions from the beginning to the latest.   So the Mintleaf looks for a default version profile at the folder where it is being execution location.</p>

<p><strong>mintleaf.yml</strong></p>
<pre class="highlight yaml"><code><span class="na">databases</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">database</span><span class="pi">:</span>
        <span class="na">id </span><span class="pi">:</span> <span class="s">abcdb</span>
        <span class="na">type </span><span class="pi">:</span> <span class="s">h2|oracle|sqlserver|postgres|mysql|sybase</span>
        <span class="na">url </span><span class="pi">:</span>  <span class="s">jdbc:h2:file:./target/ABCDB;mv_store=false;</span>
        <span class="na">username </span><span class="pi">:</span> 
        <span class="na">password </span><span class="pi">:</span> 

<span class="na">versions</span><span class="pi">:</span>

    <span class="pi">-</span> <span class="na">version</span><span class="pi">:</span>
        <span class="na">id </span><span class="pi">:</span> <span class="s">abcdb-v1</span>
        <span class="na">ver </span><span class="pi">:</span> <span class="s">1.0</span>
        <span class="na">changesets</span><span class="pi">:</span>  
            <span class="pi">-</span> <span class="s">create schema</span>
            <span class="pi">-</span> <span class="s">create tables</span>        
        <span class="na">location</span><span class="pi">:</span>
            <span class="pi">-</span>  <span class="s">path/*.sql</span>





</code></pre>
<h1 id="creating-test-data">Creating test data</h1>

<p>Before run your test you should load your test data to target test database so that your tests can be run for to prove to be working with developer code changes. So generally, your test scenearios may be involved with one or more database tables that needs to be populated with data in order to verify developer code changes either stored procedure side or application side. Mintleaf simplifies the test data creation process as easy as possible.  Here are the possible ways that one can think of creating test data with Mintleaf, </p>

<ul>
<li>Create your own data set in a csv file format and load it to your target test database</li>
<li>Or copy data from existing database to a csv file and later use it for loading in to your target test database </li>
<li>Or directly copy data from one database to another database/your target test database</li>
</ul>

<p>So over all you can use csv file and database-to-database copy of data for your tests.  </p>

<aside class="warning"> Mintleaf copy data process is intended for to use for test data creation purpose only so it is not meant for production use   
</aside>

<h3 id="usage"><em>Usage:</em></h3>

<p><strong>mintleaf -config=&lt;<a href="#configuration-file">configuration file</a>&gt; -targetdb=&lt;db id&gt; -file=&lt;csv file to save&gt; -task=&lt;dbtocsv|csvtodb|dbtodb&gt; -targetsql=&lt;a select query&gt;</strong></p>

<h2 id="database-to-csv">Database to CSV</h2>

<p>For example, if we want to dump data from a table called HRDB.USERS in abcd-db to a CSV file then you run like the following </p>
<pre class="highlight shell tab-shell"><code>
<span class="gp">&gt; </span>mintleaf --config<span class="o">=</span>connection.yml  <span class="nv">targetdb</span><span class="o">=</span>abcd-db -file<span class="o">=</span>abcd-db.csv -task<span class="o">=</span>dbtocsv <span class="nv">targetsql</span><span class="o">=</span><span class="s2">"select * from HRDB.USERS"</span>

running...done.
results stored <span class="k">in </span>adcd-db.csv, 2cols and 5 rows copied
|ID|NAME| 
|1|Allen| 
|2|Jim| 
|3|Gary|
|4|Sen|


</code></pre>
<h2 id="csv-to-database">CSV to Database</h2>

<p>Suppose you have a data in a CSV file called abcd.csv and want to load it in to a table called HRDB.USERS then you run like the following command.  Note that CSV file must have a header row as first which contains column names. Please note that whatever the column name you define in CSV file will be used exactly in your targetsql argument as shown below.  Here target sql is a template and the CSV column names are prefixed and suffixed with dollar sign as variables.   One great thing about using a template approach here is that it enables use of builtin functions of the database inside your insert statement some instances like any date formatting functions or math functions and so on.   </p>
<pre class="highlight shell tab-shell"><code>
<span class="gp">&gt; </span>mintleaf --config<span class="o">=</span>connection.yml  <span class="nv">targetdb</span><span class="o">=</span>abcd-db -file<span class="o">=</span>abcd.csv -task<span class="o">=</span>csvtodb <span class="nv">targetsql</span><span class="o">=</span><span class="s2">"INSERT INTO HRDB.USERS (ID, NAME) VALUES (</span><span class="nv">$ID$,</span><span class="s2"> </span><span class="nv">$NAME$)</span><span class="s2">"</span>

</code></pre>
<h2 id="database-to-database">Database to Database</h2>
<pre class="highlight shell tab-shell"><code>
<span class="gp">&gt; </span>mintleaf --config<span class="o">=</span>connection.yml  <span class="nv">targetdb</span><span class="o">=</span>abcd-db -sourcedb<span class="o">=</span>poppy-db -task<span class="o">=</span>dbtodb <span class="nv">targetsql</span><span class="o">=</span><span class="s2">"INSERT INTO HRDB.USERS (ID, NAME) VALUES (</span><span class="nv">$ID$,</span><span class="s2"> '</span><span class="nv">$NAME$'</span><span class="s2">)"</span> <span class="nv">sourcesql</span><span class="o">=</span><span class="s2">"SELECT ID, NAME FROM HRDB.USERS"</span>

</code></pre>
      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
